custom_logo: "ccbr_logo.png"
custom_url: "https://bioinformatics.ccr.cancer.gov/ccbr/"
custom_logo_title: "CCR Collaborative Bioinformatics Resource"

report_comment: >
  This report has been generated by <a href="https://github.com/CCBR/CHAMPAGNE" target="_blank">CCBR/CHAMPAGNE</a>.
  For information about how to interpret these results, please see the
  <a href="https://ccbr.github.io/CHAMPAGNE/" target="_blank">documentation</a>.

data_format: "yaml"

export_plots: true

fastqscreen_simpleplot: true
fn_clean_sample_names: false
log_filesize_limit: 100000000

top_modules:
  - "QC_Table"

run_modules:
  - custom_content
  - fastq_screen
  - fastqc
  - cutadapt
  - samtools
  - preseq
  - deeptools
  - phantompeakqualtools

module_order:
  - custom_content
  - deeptools
  - fastq_screen
  - fastqc
  - cutadapt
  - samtools
  - preseq
  - phantompeakqualtools

custom_data:
  QC_Table:
    id: "QC_Table"
    section_name: "ChIP-specific QC metrics"
    section_href: https://www.encodeproject.org/chip-seq/
    description: |
      <h3>Encode3 standards</h3>
      <ul>
        <li><a href='https://www.encodeproject.org/chip-seq/histone-encode4/#standards' target='_blank'>Histone standards</a></li>
        <li><a href='https://www.encodeproject.org/chip-seq/transcription-factor-encode4/#standards' target='_blank'>Transcription Factor standards</a></li>
      </ul>
      Usable fragments (A fragment corresponds to a read mapping to one location in the genome.)
      If single-end, one read is considered a fragment. If paired-end, one pair is considered a fragment. <br>
      Usable fragments for TF/narrow histones: concerning <10M, acceptable 10-20M, ideal >20M. <br>
      Usable fragments for broad histones: concerning <20M, acceptable 20-40M, ideal >40M. <br>
      <ul>
        <li> NRF: Number of distinct mapping reads after removing duplicates/total number of reads. Preferred value: NRF > 0.9, Acceptable: NRF > 0.5, Concerning (severe bottle-necking): NRF < 0.5.</li>
        <li> PBC1: Number of genomic locations where exactly one read maps uniquely/number of distinct genomic locations to which one read maps uniquely. Preferred value: PBC1 > 0.9. </li>
        <li> PBC2: Number of genomic locations where only one read maps uniquely/number of genomic locations where two reads map uniquely. Preferred value: PBC2 > 10.</li>

      </ul>
      <br>
      <h3><a href='https://github.com/kundajelab/phantompeakqualtools' target='_blank'>phantompeakqualtools</a> standards</h3>
      <ul>
      <li> NSC: cross-correlation value/minimum cross-correlation <br>
           Optimal NSC: > 1.1, Okay NSC: 1.05 - 1.1. Low NSC means low signal to noise or very few peaks (biological or technical).</li>
      <li> RSC: (cross-correlation value - minimum cross-correlation) / (correlation at phantom peak - minimum cross-correlation) <br>
           Optimal RSC: > 1, Okay RSC: 0.8-1. Low RSC means low signal to noise caused by: poor quality ChIP,
           low read sequence quality, shallow sequencing depth, or few peaks. <br> QualityTag: -2: very low, 2: very high </li>
      </ul>
    plot_type: "table"
    pconfig:
      id: "QC_Table"
      namespace: "QC Table"
    headers:
      NReads:
        description: "The number of reads sequenced"
        format: "{:,.0f}"
      N_reads_surviving_blacklist:
        description: "The number of reads surviving after filtering blacklisted regions"
        format: "{:,.0f}"
        hidden: true
      NMappedReads:
        description: "The number of reads mapped"
        format: "{:,.0f}"
      N_mapped_reads_surviving_filter:
        description: "The number of mapped reads surviving after filtering by alignment quality"
        format: "{:,.0f}"
        hidden: true
      NUniqMappedReads:
        description: "The number of mapped & filtered reads remaining after deduplication"
        format: "{:,.0f}"
      NRF:
        description: "Non-Redundant fraction"
        min: 0
        max: 0.9
        scale: "RdYlGn"
      PBC1:
        description: "PCR Bottlenecking Coefficient 1"
        min: 0
        max: 0.9
        scale: "RdYlGn"
      PBC2:
        description: "PCR Bottlenecking Coefficient 2"
        min: 0.5
        max: 5
        scale: "RdYlGn"
      FragmentLength:
        description: "Predicted fragment length by cross-correlation"
      NSC:
        description: "Normalized strand cross-correlation coefficient"
        min: 1
        max: 1.1
        scale: "RdYlGn"
        format: "{:,.2f}"
      RSC:
        description: "Relative strand cross-correlation coefficient"
        min: 0.5
        max: 1
        scale: "RdYlGn"
      Qtag:
        description: "Quality tag based on thresholded RSC"
        min: 0
        max: 2
        scale: "RdYlGn"
  spike_sf_table:
    section_name: "Spike-in scaling factors"
    plot_type: "table"
    description: "Scaling factors for spike-in normalization. Trimmed reads are aligned to the spike-in genome and deduplicated, then samples are grouped by antibody when computing scaling factors. The normalization method is set by the `spike_norm_method` parameter."
    headers:
      sample:
        description: "Sample ID"
      antibody:
        description: "Antibody used for the ChIP experiment, as recorded in the samplesheet."
      scaling_factor:
        description: "Scaling factor for spike-in normalization. Samples are grouped by antibody when computing scaling factors."
        format: "{:,.4f}"
      n_spikein_reads:
        description: "Number of reads that aligned to the spike-in genome after deduplication"
        format: "{:,.0f}"
  NGSQC_data:
    section_name: "NGSQC plot"
    plot_type: "linegraph"
    description: "Total originally mapped reads are randomly subsampled at 50% and 90% density. The similarity QC indicator (simQCi) refers to the fraction of chromatin regions which reveal a proportional decrease of read count intensities (RCIs) in the subset sampled at 90% relative to that sampled at 50% and is plotted for 3 dRCI thresholds, namely, 2.5%, 5% and 10%. simQCi should decrease with increase in dRCI and lower simQCi is an indicator of good overall quality. In other words, the flatter the line the higher the quality. The minimal theoretical value for simQCi is 1."
    pconfig:
      xlab: "percent RCI difference"
      ylab: "Similarity QCi (s90/s50)"
      ymax: 100
      ymin: 1
  frip_samples:
    parent_id: peak_qc
    parent_name: "Peak QC"
    parent_description: "Quality control metrics on called peaks"
    id: frip_samples
    section_name: "FRiP of all samples"
  frip_nbases:
    parent_id: peak_qc
    id: frip_nbases
    section_name: "FRiP vs. number of bases"
  peak_widths:
    parent_id: peak_qc
    id: peak_widths
    section_name: "Peak widths"
    description: "Histogram of peak widths. GEM is not shown because all GEM peaks are 200 bp wide."
  jaccard_heatmap:
    parent_id: peak_qc
    id: jaccard_heatmap
    section_name: "Heatmap of Jaccard index"
  jaccard_pca_all:
    parent_id: peak_qc
    id: jaccard_pca_all
    section_name: "PCA of Jaccard index all-vs-all"
    description: "Peaks from all-vs-all samples & tools"
  jaccard_pca_tools:
    parent_id: peak_qc
    id: jaccard_pca_tools
    section_name: "PCA of Jaccard index on peak-calling tools"
    description: "Separate PCAs on peaks from peal-calling tools"
  deeptools_corr_heatmap:
    id: "deeptools_corr_heatmap"
    section_name: "deepTools Correlation Heatmap"
    description: "Correlation heatmap generated by deepTools plotCorrelation. The correlation method (spearman or pearson) is configured via the deeptools_corr_method parameter."

sp:
  QC_Table:
    fn: "qc_table.tsv"
  spike_sf_table:
    fn: "spike_sf.tsv"
  NGSQC_data:
    fn: "*NGSQC.txt"
  frip_samples:
    fn: "FRiP_samples*.png"
  frip_nbases:
    fn: "FRiP_nbases*.png"
  peak_widths:
    fn: "peak_widths_histogram.png"
  jaccard_heatmap:
    fn: "jaccard_heatmap_all*.png"
  jaccard_pca_all:
    fn: "jaccard_pca_all*.png"
  jaccard_pca_tools:
    fn: "jaccard_pca_tool*.png"
  deeptools_corr_heatmap:
    fn: "*.*_heatmap_deeptools.png"
ignore_images: false
